<div class="w-full">
  <form class="w-full" [formGroup]="this.studentForm">
    <div class="flex">
      <!-- nombre -->
      <fieldset class="fieldset m-3">
        <legend class="fieldset-legend">Nombre</legend>
        <input
          type="text"
          class="input"
          placeholder="Nombre"
          formControlName="name"
        />
        <!-- VALIACION DEL ERROR -->
        @if(this.formUtils.isValidField(this.studentForm, 'name')){
        <span class="fieldset-label text-error">
          {{ this.formUtils.getFieldError(this.studentForm, "name") }}
        </span>
        }
      </fieldset>
      <!-- apellidos -->
      <fieldset class="fieldset m-3 w-full">
        <legend class="fieldset-legend">Apellidos</legend>
        <input
          type="text"
          class="input"
          placeholder="Introduce apellidos"
          formControlName="lastname"
        />
        <!-- VALIACION DEL ERROR -->
        @if(this.formUtils.isValidField(this.studentForm, 'lastname')){
        <span class="fieldset-label text-error">
          {{ this.formUtils.getFieldError(this.studentForm, "lastname") }}
        </span>
        }
      </fieldset>
    </div>

    <div class="flex justify-center items-center">
      <div class="flex flex-col">
        <!-- nacionalidad -->
        <fieldset class="fieldset m-3 w-full">
          <legend class="fieldset-legend">Region</legend>
          <select class="select" formControlName="region">
            <option disabled selected>Selecciona un continente</option>

            @for (region of this.countryService.regions; track region) {
            <option>{{ region }}</option>
            }
          </select>
          <!-- VALIACION DEL ERROR -->
          @if(this.formUtils.isValidField(this.studentForm, 'region')){
          <span class="fieldset-label text-error">
            {{ this.formUtils.getFieldError(this.studentForm, "region") }}
          </span>
          }
        </fieldset>
        <!-- PAIS -->
        <fieldset class="fieldset m-3 w-full">
          <legend class="fieldset-legend">Nacionalidad</legend>
          <select class="select" formControlName="country">
            <option disabled selected>Selecciona un pais</option>

            @for (country of countriesByRegion(); track country.cca3) {
            <option selected>{{ country.name.common }}</option>

            }
          </select>
          <!-- VALIACION DEL ERROR -->
          @if(this.formUtils.isValidField(this.studentForm, 'country')){
          <span class="fieldset-label text-error">
            {{ this.formUtils.getFieldError(this.studentForm, "country") }}
          </span>
          }
        </fieldset>
      </div>

      <!-- fecha de nacimiento -->
      <fieldset class="fieldset m-3 w-full px-3">
        <legend class="fieldset-legend">Fecha de nacimiento</legend>
        <input
          type="date"
          class="input"
          formControlName="birthdate"
          [max]="maxDate"
        />
        <!-- VALIACION DEL ERROR -->
        @if(this.formUtils.isValidField(this.studentForm, 'birthdate')){
        <span class="fieldset-label text-error">
          {{ this.formUtils.getFieldError(this.studentForm, "birthdate") }}
        </span>
        }
      </fieldset>
    </div>

    <div class="flex">
      <!-- alimentacion -->
      <fieldset class="fieldset m-3 w-full">
        <legend class="fieldset-legend">Tipo de alimentación</legend>
        <select class="select" formControlName="alimentation">
          <option disabled selected>Selecciona un alimentación</option>
          <option>Triturado</option>
          <option>Entero</option>
          <option>Biberón</option>
        </select>
        <!-- VALIACION DEL ERROR -->
        @if(this.formUtils.isValidField(this.studentForm, 'alimentation')){
        <span class="fieldset-label text-error">
          {{ this.formUtils.getFieldError(this.studentForm, "alimentation") }}
        </span>
        }
      </fieldset>
      <!-- AULA -->
      <fieldset class="fieldset m-3 w-full">
        <legend class="fieldset-legend">Aula</legend>
        <select class="select" formControlName="classroom">
          <option disabled selected>Selecciona aula</option>

          @for (classroom of classrooms(); track classroom.id) {
          <option [value]="classroom.id">{{ classroom.name }}</option>
          }
        </select>
        <!-- VALIACION DEL ERROR -->
        @if(this.formUtils.isValidField(this.studentForm, 'classroom')){
        <span class="fieldset-label text-error">
          {{ this.formUtils.getFieldError(this.studentForm, "classroom") }}
        </span>
        }
      </fieldset>
    </div>

    <div class="flex flex-row justify-end">
      <!-- BOTONES -->
      <button
        class="btn btn-circle btn-warning mx-5"
        (click)="changeParentFormVisibility($event)"
        [disabled]="studentFormService._parents().length === 2"
      >
        <svg
          width="800px"
          height="800px"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M6 12H18M12 6V18"
            stroke="#000000"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </button>

      <input
        type="submit"
        class="btn btn-accent mx-5"
        value="Guardar"
        (click)="onSubmitStudent()"
      />
    </div>

    <!-- FORMULARIO DEL PADRE -->
    <div class="w-full">
      @for (parent of studentFormService._parents(); track parent.docid) {
      <div class="flex flex-row bg-accent rounded-2xl m-3 justify-between px-3">
        <h3 class="m-2 text-accent-content">
          {{ parent.name }} {{ parent.lastname }}
        </h3>
        <h3 class="m-2 text-accent-content">{{ parent.docid }}</h3>
        <div class="flex justify-between items-center">
          <i
            class="fa-solid fa-xmark bg-war transform transition duration-500 hover:scale-200 hover:rotate-180"
            style="color: #a71b4c"
            (click)="removeParentFromForm(parent.docid)"
          ></i>
        </div>
      </div>
      }
    </div>

    @if(isVisibleParentForm){ @if(studentFormService._parents().length != 2){
    <app-parent-form />
    } }

    <!-- <span>Valid</span>
    <pre>{{ studentForm.valid | json }}</pre>
    <br />

    <span>Value</span>
    <pre>{{ studentForm.value | json }}</pre>
    <br />

    <span>Errors</span>
    <pre>{{ studentForm.controls["name"].errors | json }}</pre>
    <br /> -->

    <div class="w-full">
      <fieldset class="fieldset">
        <legend class="fieldset-legend">Comentarios</legend>
        <textarea class="textarea h-24 w-full" placeholder="Bio"></textarea>
        <!-- <div class="fieldset-label">Optional</div> -->
      </fieldset>
    </div>
  </form>
</div>
